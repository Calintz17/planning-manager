<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ROMAN — Resource Optimization & Management Allocation Network</title>
<link rel="stylesheet" href="./assets/css/styles.css">
</head>
<body>
<header>
  <div class="container row">
    <div class="title">ROMAN | Resource Optimization & Management Allocation Network</div>

    <!-- ====== HEADER RIGHT (MAJ B4) ====== -->
    <div class="row" style="margin-left:auto; gap:8px; align-items:center">
      <!-- Statut d'auth (remplacé dynamiquement par auth.js) -->
      <div id="authStatus" class="muted">Not signed in</div>

      <!-- Actions Auth -->
      <button class="btn ghost" id="btnLogin">Sign in</button>
      <button class="btn ghost" id="btnLogout" style="display:none">Sign out</button>

      <!-- Persistance locale (état ROMAN.store) -->
      <button class="btn ghost" id="btnSave">Save</button>
      <button class="btn ghost" id="btnLoad">Load</button>
      <button class="btn ghost" id="btnResetAll" title="Clear storage & reload">Reset</button>
    </div>
    <!-- ====== /HEADER RIGHT ====== -->
  </div>

  <div class="container tabs">
    <button class="tab active" data-tab="Attendance">Attendance</button>
    <button class="tab" data-tab="Landing">Landing</button>
    <button class="tab" data-tab="Agents">Agents</button>
    <button class="tab" data-tab="Tasks">Tasks</button>
    <button class="tab" data-tab="Forecast">Forecast</button>
    <button class="tab" data-tab="Regulations">Regulations</button>
  </div>
</header>

<main class="container">
  <!-- ===== TAB: ATTENDANCE (4 weeks sliding) ===== -->
<section id="tab-Attendance" class="card">
  <h3 style="margin:0 0 12px 0">Attendance (4 weeks)</h3>

  <!-- KPI Adherence -->
  <div id="att-kpi" style="display:flex;flex-direction:column;align-items:center;gap:8px;margin:8px 0 16px 0">
    <div style="font-weight:700;color:#0299FD">Adherence</div>
    <div class="att-progress">
      <div class="att-progress-fill" id="attProgressFill" style="width:0%"></div>
      <div class="att-progress-label" id="attProgressLabel">0%</div>
    </div>
  </div>

  <!-- Contrôles -->
  <div class="row" style="gap:8px;align-items:center;margin-bottom:8px">
    <span class="label">Region</span>
    <select id="attRegion" class="select">
      <option>Europe</option>
      <option>Americas</option>
      <option>Greater China</option>
      <option>Japan</option>
      <option>South Korea</option>
      <option>SEAO</option>
    </select>

    <span class="label">Start</span>
    <input type="date" id="attStart" class="select"/>
    <button class="btn" id="attRecalc">Recalculate</button>
  </div>

  <!-- Grille -->
  <div class="attendance-wrap">
    <div id="attendanceGrid"></div>
  </div>
</section>

  <!-- ===== TAB: LANDING (Planning View) ===== -->
  <section id="tab-Landing" class="card">
    <h3 style="margin:0 0 8px 0">Weekly Planning</h3>
    <div class="row" style="margin-bottom:8px">
      <div class="controls-right">
        <span class="label">Year</span>
        <select id="selYear" class="select"></select>

        <span class="label">Week</span>
        <select id="selWeek" class="select"></select>

        <span class="label">Region</span>
        <select id="selRegion" class="select">
          <option>Europe</option>
          <option>Americas</option>
          <option>Greater China</option>
          <option>Japan</option>
          <option>South Korea</option>
          <option>SEAO</option>
        </select>

        <button class="btn" id="btnOptimize">Optimize</button>
        <button class="btn ghost" id="btnClear">Clear</button>
        <button class="btn ghost" id="btnExport">Export CSV</button>
        <span id="coverageBadge" class="badge" style="margin-left:4px">No run</span>
      </div>
    </div>

<div class="legend" style="margin-bottom:8px">
  <span class="task-chip t-CALL">Call</span>
  <span class="task-chip t-MAIL">Mail</span>
  <span class="task-chip t-CHAT">Chat</span>
  <span class="task-chip t-CLIENTELING">Clienteling</span>
  <span class="task-chip t-FRAUD">Fraud</span>
  <span class="task-chip t-BACK-OFFICE">Back Office</span>
  <span class="task-chip t-LUNCH-BREAK">Lunch Break</span>
  <span class="task-chip t-BREAK">Break</span>
  <span class="task-chip t-MORNING-BRIEF">Morning Brief</span>
  <span class="task-chip t-TRAINING">Training</span>
</div>

    <div class="planner" id="plannerHost"></div>
  </section>

  <!-- ===== TAB: AGENTS ===== -->
  <section id="tab-Agents" class="card" style="display:none">
    <h3 style="margin:0 0 8px 0">Agents</h3>

    <!-- ===== C. Directory (live from Supabase) — AJOUTÉ ===== -->
    <div class="card" style="padding:12px;margin:12px 0">
      <h4 style="margin:0 0 8px 0">C. Directory (live from Supabase)</h4>
      <div class="row" style="gap:8px;align-items:center;margin-bottom:8px">
        <label class="muted">Region:</label>
        <select id="region-filter" class="select">
          <option value="ALL">All</option>
          <option value="Europe">Europe</option>
          <option value="Americas">Americas</option>
          <option value="Greater China">Greater China</option>
          <option value="Japan">Japan</option>
          <option value="South Korea">South Korea</option>
          <option value="SEAO">SEAO</option>
        </select>
        <span class="badge" style="margin-left:auto">Count: <span id="agents-count">0</span></span>
      </div>
      <div class="scroll" style="max-height:420px; overflow:auto; border:1px solid #e5e7eb; border-radius:8px;">
        <table id="agents-table" class="sticky-left" style="width:100%; border-collapse:collapse;">
          <thead style="background:#f9fafb;">
            <tr>
              <th id="th-name" style="text-align:left;padding:10px;border-bottom:1px solid #e5e7eb;">Name</th>
              <th style="text-align:left;padding:10px;border-bottom:1px solid #e5e7eb;">Region</th>
              <th style="text-align:left;padding:10px;border-bottom:1px solid #e5e7eb;">Status</th>
              <th style="text-align:left;padding:10px;border-bottom:1px solid #e5e7eb;">Skills</th>
            </tr>
          </thead>
          <tbody>
            <!-- Filled by assets/js/agents.js -->
          </tbody>
        </table>
      </div>
    </div>
    <!-- ===== /C. Directory ===== -->

    <div class="row" style="margin-bottom:8px">
      <button class="btn" id="agAdd">Add agent</button>
      <button class="btn ghost" id="agReset">Reset sample</button>
      <button class="btn ghost" id="agExport">Export CSV</button>
      <span class="badge" id="agCount" style="margin-left:auto">0 agents</span>
    </div>

    <div class="card" style="padding:12px;margin:12px 0">
      <h4 style="margin:0 0 8px 0">A. Roster & Availability</h4>
      <div class="muted" style="margin-bottom:6px">
        Present = working day; PTO flag = quick absence override for that day.
      </div>
      <div class="scroll">
        <table id="agRoster" class="sticky-left">
          <thead>
            <tr>
              <th>Agent</th>
              <th>Region</th>
              <th>Template</th>
              <th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th>Sat</th><th>Sun</th>
              <th class="mono">PTO Mon</th><th class="mono">PTO Tue</th><th class="mono">PTO Wed</th>
              <th class="mono">PTO Thu</th><th class="mono">PTO Fri</th><th class="mono">PTO Sat</th><th class="mono">PTO Sun</th>
              <th></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <div class="card" style="padding:12px;margin:12px 0">
      <h4 style="margin:0 0 8px 0">B. Skills Matrix (opt-out per task)</h4>
      <div class="muted" style="margin-bottom:6px">
        Tasks are checked by default; uncheck to opt-out the agent from a task.
      </div>
      <div class="scroll" style="max-height:420px">
        <table id="agSkills" class="sticky-left">
          <thead>
            <tr id="agSkillsHead">
              <th>Agent</th>
            </tr>
          </thead>
          <tbody id="agSkillsBody"></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- ===== TAB: TASKS ===== -->
  <section id="tab-Tasks" class="card" style="display:none">
    <h3 style="margin:0 0 8px 0">Tasks</h3>
    <div class="row" style="margin-bottom:8px">
      <button class="btn" id="btnTasksReset">Reset to defaults</button>
      <button class="btn ghost" id="btnTasksExport">Export CSV</button>
      <span class="badge" id="tasksCountBadge" style="margin-left:auto">0 tasks</span>
    </div>
    <div class="scroll" style="max-height:520px">
      <table id="tasksTable">
        <thead>
          <tr>
            <th style="width:28%">Task</th>
            <th style="width:20%">Priority</th>
            <th style="width:18%">Avg Handle Time (min)</th>
            <th style="width:14%">Enabled</th>
            <th style="width:20%">Notes</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <!-- ===== TAB: FORECAST ===== -->
  <section id="tab-Forecast" class="card" style="display:none">
    <h3 style="margin:0 0 8px 0">Forecast</h3>
    <div class="card" style="padding:12px;margin:12px 0">
      <h4 style="margin:0 0 8px 0">A. Regional totals & task %</h4>
      <div class="row" style="margin-bottom:8px">
        <span class="muted">Each region has a total volume. The task row % must sum to 100.</span>
        <span class="badge" id="fcTaskAllOk" style="margin-left:auto">Unchecked</span>
      </div>
      <div class="row" style="gap:12px">
        <div style="flex:1">
          <div class="scroll">
            <table id="fcRegionTotals">
              <thead><tr><th>Region</th><th>Total forecast</th><th class="mono">Sum % (tasks)</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
        <div style="flex:2">
          <div class="scroll" style="max-height:420px">
            <table id="fcTaskSplit" class="sticky-left">
              <thead><tr id="fcTaskSplitHead"></tr></thead>
              <tbody id="fcTaskSplitBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <div class="card" style="padding:12px;margin:12px 0">
      <h4 style="margin:0 0 8px 0">B. Weekly repartition (w01–w52 × regions)</h4>
      <div class="row" style="margin-bottom:8px">
        <span class="muted">Soft check: each week row ~100% across regions.</span>
        <span class="badge" id="fcWeeklyOk" style="margin-left:auto">Unchecked</span>
      </div>
      <div class="scroll" style="max-height:420px">
        <table id="fcWeekly" class="sticky-left">
          <thead><tr id="fcWeeklyHead"><th>Week</th></tr></thead>
          <tbody id="fcWeeklyBody"></tbody>
        </table>
      </div>
    </div>

    <div class="card" style="padding:12px;margin:12px 0">
      <h4 style="margin:0 0 8px 0">C. Daily + Hourly repartition (per region)</h4>
      <p class="muted" style="margin:0 0 6px 0">For each region, set: column 1 = day share of weekly (must sum 100). Remaining columns (08:00→21:00) must sum 100 per row.</p>
      <div id="fcHourlyBlocks"></div>
    </div>

    <div class="row" style="gap:8px">
      <button class="btn" id="fcValidate">Validate all %</button>
      <button class="btn ghost" id="fcReset">Reset defaults</button>
      <span class="badge" id="fcSummary" style="margin-left:auto">No check yet</span>
    </div>
  </section>

  <!-- ===== TAB: REGULATIONS ===== -->
  <section id="tab-Regulations" class="card" style="display:none">
    <h3 style="margin:0 0 8px 0">Regulations</h3>
    <div class="row" style="margin-bottom:8px">
      <label class="muted">Filter region:</label>
      <select id="rgFilter" class="input">
        <option value="ALL">All regions</option>
        <option value="Europe">Europe</option>
        <option value="Americas">Americas</option>
        <option value="Greater China">Greater China</option>
        <option value="Japan">Japan</option>
        <option value="South Korea">South Korea</option>
        <option value="SEAO">SEAO</option>
      </select>
      <button class="btn" id="rgAdd">Add rule</button>
      <button class="btn ghost" id="rgReset">Reset defaults</button>
      <button class="btn ghost" id="rgExport">Export CSV</button>
      <span class="badge" id="rgCount" style="margin-left:auto">0 rules</span>
    </div>

    <div class="scroll" style="max-height:520px">
      <table id="rgTable" class="sticky-left">
        <thead>
          <tr>
            <th style="width:26%">Rule</th>
            <th style="width:16%">Region</th>
            <th style="width:16%">Value</th>
            <th style="width:30%">Notes</th>
            <th style="width:8%">Enabled</th>
            <th style="width:8%"></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <div class="footer">© Roman Inc.</div>
</main>

<!-- Entrée modules -->
<script type="module" src="./assets/js/main.js"></script>
<!-- AJOUT: script Agents (Supabase) -->
<script type="module" src="./assets/js/agents.js" defer></script>
</body>
</html>
